<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settle in France — Packages</title>
  <link rel="stylesheet" href="styles.css?v=3" />
</head>

<body id="top">

<header class="topbar">
  <div class="container topbar__inner">

    <div class="brand">
      <div class="brand__mark" aria-hidden="true">SF</div>
      <div class="brand__text">
        <div class="brand__name">Settle in France</div>
        <div class="brand__tag" data-i18n="brand_tag_packages">Choose your support package</div>
      </div>
    </div>

    <div class="lang">
      <button class="lang__btn" type="button" onclick="setLang('en')" id="langEn">EN</button>
      <button class="lang__btn" type="button" onclick="setLang('es')" id="langEs">ES</button>
    </div>

  </div>
</header>

<main>
  <section class="section section--soft">
    <div class="container">

      <div class="section__head">
        <h2 data-i18n="p2_title">Packages</h2>
        <p class="muted" data-i18n="p2_sub">Select one to continue to the pricing question.</p>
      </div>

      <div class="pricing">

        <div class="price-card">
          <div class="price-card__head">
            <h3 data-i18n="basic">Basic</h3>
            <div class="package-subtitle" data-i18n="basic_timeframe">Self-paced support</div>
          </div>

          <ul class="bullets">
            <li data-i18n="basic_b1">Step-by-step roadmap</li>
            <li data-i18n="basic_b2">Document repository</li>
            <li data-i18n="basic_b3">Deadline reminders + tracking</li>
            <li data-i18n="basic_b4">Templates and checklists</li>
          </ul>

          <button class="btn btn--secondary btn--full" type="button" onclick="selectPackage('basic')">
            <span data-i18n="select_basic">Select Basic</span>
          </button>
        </div>

        <div class="price-card price-card--highlight">
          <div class="price-card__head">
            <h3 data-i18n="complete">Complete</h3>
            <div class="package-subtitle" data-i18n="complete_timeframe">Fully accompanied — completed within 2 months</div>
          </div>

          <ul class="bullets">
            <li data-i18n="complete_b1">Everything in Basic</li>
            <li data-i18n="complete_b2">Pre-filled forms</li>
            <li data-i18n="complete_b3">Expert validation</li>
            <li data-i18n="complete_b4">Aid eligibility checklist</li>
            <li data-i18n="complete_b5">Priority support workflow</li>
          </ul>

          <button class="btn btn--primary btn--full" type="button" onclick="selectPackage('complete')">
            <span data-i18n="select_complete">Select Complete</span>
          </button>
        </div>

      </div>

    </div>
  </section>
</main>

<script>
  /* ============================
     CONFIG
  ============================ */

  const SUPABASE_URL = "https://oljeghivxtdfnlgqqrlt.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_mV8zSvwppl_cHDDVp3q4PA_qfA65R5F";

  const SESSION_KEY = "sf_session_id_v1";
  const LANG_KEY = "sf_lang_v1";
  const SELECTED_KEY = "sf_selected_package_v1";

  const I18N = {
    en: {
      brand_tag_packages: "Choose your support package",
      p2_title: "Packages",
      p2_sub: "Select one to continue to the pricing question.",

      basic: "Basic",
      basic_timeframe: "Self-paced support",
      basic_b1: "Step-by-step roadmap",
      basic_b2: "Document repository",
      basic_b3: "Deadline reminders + tracking",
      basic_b4: "Templates and checklists",
      select_basic: "Select Basic",

      complete: "Complete",
      complete_timeframe: "Fully accompanied — completed within 2 months",
      complete_b1: "Everything in Basic",
      complete_b2: "Pre-filled forms",
      complete_b3: "Expert validation",
      complete_b4: "Aid eligibility checklist",
      complete_b5: "Priority support workflow",
      select_complete: "Select Complete"
    },
    es: {
      brand_tag_packages: "Elige tu paquete de soporte",
      p2_title: "Paquetes",
      p2_sub: "Elige uno para continuar valorando tu preferencia en precios y tiempo.",

      basic: "Básico",
      basic_timeframe: "Recibe la guía necesaria para que vayas a tu propio ritmo",
      basic_b1: "Guía paso a paso",
      basic_b2: "Repositorio de documentos",
      basic_b3: "Recordatorios y seguimiento de plazos",
      basic_b4: "Plantillas y listas de verificación",
      select_basic: "Elegir Básico",

      complete: "Completo",
      complete_timeframe: "Recibe acompañamiento completo y ten todo listo en un rango de 2 meses",
      complete_b1: "Todo lo incluido en Básico",
      complete_b2: "Formularios pre-rellenados",
      complete_b3: "Validación experta",
      complete_b4: "Lista de elegibilidad para ayudas",
      complete_b5: "Soporte prioritario",
      select_complete: "Elegir Completo"
    }
  };

  /* ============================
     HELPERS
  ============================ */

  function getSessionId(){
    let id = localStorage.getItem(SESSION_KEY);
    if(!id){
      id = crypto.randomUUID();
      localStorage.setItem(SESSION_KEY, id);
    }
    return id;
  }

  function getLang(){
    return localStorage.getItem(LANG_KEY) || "en";
  }

  async function supabaseInsertEvent(event_type, payload = {}){
    const res = await fetch(`${SUPABASE_URL}/rest/v1/sif_events`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "apikey": SUPABASE_ANON_KEY,
        "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
        "Prefer": "return=minimal"
      },
      body: JSON.stringify({
        session_id: getSessionId(),
        event_type,
        page: "packages",
        lang: getLang(),
        payload
      })
    });

    if (!res.ok) {
      const txt = await res.text().catch(() => "");
      console.warn("Supabase insert failed:", res.status, txt);
    }
  }

  /* ============================
     I18N
  ============================ */

  function t(key){
    const lang = getLang();
    return (I18N[lang] && I18N[lang][key]) ? I18N[lang][key] : key;
  }

  function setLang(lang){
    localStorage.setItem(LANG_KEY, lang);
    applyLang();
  }

  function applyLang(){
    const lang = getLang();

    const enBtn = document.getElementById("langEn");
    const esBtn = document.getElementById("langEs");
    if (enBtn && esBtn) {
      enBtn.classList.toggle("is-active", lang === "en");
      esBtn.classList.toggle("is-active", lang === "es");
    }

    document.querySelectorAll("[data-i18n]").forEach(el => {
      el.textContent = t(el.getAttribute("data-i18n"));
    });
  }

  /* ============================
     PAGE ACTIONS
  ============================ */

  async function selectPackage(pkg){
    localStorage.setItem(SELECTED_KEY, pkg);

    await supabaseInsertEvent("phase2_package_selected", { selectedPackage: pkg });

    window.location.href = "wtp.html";
  }

  // init
  applyLang();
</script>

</body>
</html>
