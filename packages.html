<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settle in France — Packages</title>
  <link rel="stylesheet" href="styles.css?v=2" />
</head>

<body id="top">

<header class="topbar">
  <div class="container topbar__inner">

    <div class="brand">
      <div class="brand__mark">SF</div>
      <div class="brand__text">
        <div class="brand__name">Settle in France</div>
        <div class="brand__tag" data-i18n="brand_tag_packages">
          Choose your support package
        </div>
      </div>
    </div>

    <div class="lang">
      <button class="lang__btn" onclick="setLang('en')" id="langEn">EN</button>
      <button class="lang__btn" onclick="setLang('es')" id="langEs">ES</button>
    </div>

  </div>
</header>

<main>

<section class="section section--soft">
  <div class="container">

    <div class="section__head">
      <h2 data-i18n="p2_title">Packages</h2>
      <p class="muted" data-i18n="p2_sub">
        Select one to continue to the pricing question.
      </p>
    </div>

    <!-- THIS IS THE GRID CONTAINER -->
    <div class="pricing">

      <!-- BASIC CARD -->
      <div class="price-card">

        <div class="price-card__head">
          <h3 data-i18n="basic">Basic</h3>

          <div class="package-subtitle" data-i18n="basic_timeframe">
            Self-paced support
          </div>
        </div>

        <ul class="bullets">
          <li data-i18n="basic_b1">Step-by-step roadmap</li>
          <li data-i18n="basic_b2">Document repository</li>
          <li data-i18n="basic_b3">Deadline reminders + tracking</li>
          <li data-i18n="basic_b4">Templates and checklists</li>
        </ul>

        <button class="btn btn--secondary btn--full"
                onclick="selectPackage('basic')">
          <span data-i18n="select_basic">Select Basic</span>
        </button>

      </div>
      <!-- END BASIC CARD -->


      <!-- COMPLETE CARD -->
      <div class="price-card price-card--highlight">

        <div class="price-card__head">
          <h3 data-i18n="complete">Complete</h3>

          <div class="package-subtitle" data-i18n="complete_timeframe">
            Fully accompanied — completed within 2 months
          </div>
        </div>

        <ul class="bullets">
          <li data-i18n="complete_b1">Everything in Basic</li>
          <li data-i18n="complete_b2">Pre-filled forms</li>
          <li data-i18n="complete_b3">Expert validation</li>
          <li data-i18n="complete_b4">Aid eligibility checklist</li>
          <li data-i18n="complete_b5">Priority support workflow</li>
        </ul>

        <button class="btn btn--primary btn--full"
                onclick="selectPackage('complete')">
          <span data-i18n="select_complete">Select Complete</span>
        </button>

      </div>
      <!-- END COMPLETE CARD -->


    </div>
    <!-- END GRID -->


  </div>
</section>

</main>

<script>
const I18N = {

  en: {

    brand_tag_packages:
      "Choose your support package",

    p2_title:
      "Packages",

    p2_sub:
      "Select one to continue to the pricing question.",

    basic:
      "Basic",

    basic_timeframe:
      "Self-paced support",

    basic_b1:
      "Step-by-step roadmap",

    basic_b2:
      "Document repository",

    basic_b3:
      "Deadline reminders + tracking",

    basic_b4:
      "Templates and checklists",

    select_basic:
      "Select Basic",

    complete:
      "Complete",

    complete_timeframe:
      "Fully accompanied — completed within 2 months",

    complete_b1:
      "Everything in Basic",

    complete_b2:
      "Pre-filled forms",

    complete_b3:
      "Expert validation",

    complete_b4:
      "Aid eligibility checklist",

    complete_b5:
      "Priority support workflow",

    select_complete:
      "Select Complete"

  },


  es: {

    brand_tag_packages:
      "Elige tu paquete de soporte",

    p2_title:
      "Paquetes",

    p2_sub:
      "Selecciona uno para continuar con la pregunta de precio.",

    basic:
      "Básico",

    basic_timeframe:
      "Soporte a tu propio ritmo",

    basic_b1:
      "Guía paso a paso",

    basic_b2:
      "Repositorio de documentos",

    basic_b3:
      "Recordatorios y seguimiento de plazos",

    basic_b4:
      "Plantillas y listas de verificación",

    select_basic:
      "Seleccionar Básico",

    complete:
      "Completo",

    complete_timeframe:
      "Acompañamiento completo — finalizado en 2 meses",

    complete_b1:
      "Todo lo incluido en Básico",

    complete_b2:
      "Formularios pre-rellenados",

    complete_b3:
      "Validación experta",

    complete_b4:
      "Lista de elegibilidad para ayudas",

    complete_b5:
      "Soporte prioritario",

    select_complete:
      "Seleccionar Completo"

  }

};


/* ============================
   LANGUAGE FUNCTIONS
============================ */

function setLang(lang){

  localStorage.setItem("sf_lang_v1", lang)

  applyTranslations()
}


function getLang(){

  return localStorage.getItem("sf_lang_v1") || "en"
}


function applyTranslations(){

  const lang = getLang()

  document.querySelectorAll("[data-i18n]").forEach(el => {

    const key = el.getAttribute("data-i18n")

    if(I18N[lang][key]){

      el.textContent = I18N[lang][key]

    }

  })

}


/* ============================
   INIT
============================ */

applyTranslations()
const SUPABASE_URL =
"https://oljeghivxtdfnlgqqrlt.supabase.co";

const SUPABASE_ANON_KEY =
"sb_publishable_mV8zSvwppl_cHDDVp3q4PA_qfA65R5F";

function getSessionId(){
  let id = localStorage.getItem("sf_session_id_v1");

  if(!id){
    id = crypto.randomUUID();
    localStorage.setItem("sf_session_id_v1", id);
  }

  return id;
}

function getLang(){
  return localStorage.getItem("sf_lang_v1") || "en";
}

async function supabaseInsertEvent(event_type, payload={}){

  await fetch(`${SUPABASE_URL}/rest/v1/sif_events`, {

    method:"POST",

    headers:{
      "Content-Type":"application/json",
      "apikey":SUPABASE_ANON_KEY,
      "Authorization":`Bearer ${SUPABASE_ANON_KEY}`,
      "Prefer":"return=minimal"
    },

    body:JSON.stringify({

      session_id:getSessionId(),
      event_type,
      page:"packages",
      lang:getLang(),
      payload

    })
  })
}

async function selectPackage(pkg){

  localStorage.setItem("sf_selected_package_v1", pkg)

  await supabaseInsertEvent(
    "phase2_package_selected",
    {selectedPackage:pkg}
  )

  window.location.href="wtp.html"
}

</script>

</body>
</html>
