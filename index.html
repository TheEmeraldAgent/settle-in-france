<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settle in France — Quick question</title>
  <link rel="stylesheet" href="styles.css?v=3" />
</head>

<body id="top">

  <header class="topbar">
    <div class="container topbar__inner">

      <div class="brand">
        <div class="brand__mark" aria-hidden="true">SF</div>
        <div class="brand__text">
          <div class="brand__name">Settle in France</div>
          <div class="brand__tag" data-i18n="brand_tag_index">Administrative support for international students</div>
        </div>
      </div>

      <div class="lang">
        <button class="lang__btn" type="button" onclick="setLang('en')" id="langEn">EN</button>
        <button class="lang__btn" type="button" onclick="setLang('es')" id="langEs">ES</button>
      </div>

    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container narrow">
        <h1 class="hero__title" data-i18n="hero_title">
          All your French administrative procedures — handled in one structured system.
        </h1>

        <p class="hero__subtitle" data-i18n="hero_subtitle">
          From housing documents to CAF, banking, and university formalities,
          our bundle combines guidance, tools, and expert validation in a single coordinated support package.
        </p>
      </div>
    </section>

    <section class="section">
      <div class="container narrow">
        <div class="card card--center">

          <h1 class="h1" data-i18n="p1_title">
            Would you be interested in having all these services handled in one single package?
          </h1>

          <p class="muted" data-i18n="p1_sub">
            If you choose “Yes”, you’ll see our packages. If “No”, we’ll note your preference.
          </p>

          <div class="yesno">
            <label class="radio">
              <input type="radio" name="bundle" value="yes" />
              <span data-i18n="p1_yes">Yes - I'd get “All-in-one” bundle support</span>
            </label>

            <label class="radio">
              <input type="radio" name="bundle" value="no" />
              <span data-i18n="p1_no">No - I'd rather manage each process separately on my own</span>
            </label>
          </div>

          <button class="btn btn--primary btn--full" type="button" onclick="submitPhase1()">
            <span data-i18n="p1_continue">Continue</span>
          </button>

          <div id="thanksBox" class="thanks" hidden data-i18n="p1_thanks">Thanks for your answer.</div>

        </div>
      </div>
    </section>
  </main>

  <script>
    /* ============================
       CONFIG
    ============================ */

    const SUPABASE_URL = "https://oljeghivxtdfnlgqqrlt.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_mV8zSvwppl_cHDDVp3q4PA_qfA65R5F";

    const SESSION_KEY = "sf_session_id_v1";
    const LANG_KEY = "sf_lang_v1";

    const I18N = {
      en: {
        brand_tag_index: "Administrative support for international students",
        hero_title: "All your French administrative procedures — handled in one structured system.",
        hero_subtitle: "From housing documents to CAF, banking, and university formalities, our bundle combines guidance, tools, and expert validation in a single coordinated support package.",
        p1_title: "Would you be interested in having all these services handled in one single package?",
        p1_sub: "If you choose “Yes”, you’ll see our packages. If “No”, we’ll note your preference.",
        p1_yes: "Yes - I'd get “All-in-one” bundle support",
        p1_no: "No - I'd rather manage each process separately on my own",
        p1_continue: "Continue",
        p1_thanks: "Thanks for your answer."
      },
      es: {
        brand_tag_index: "Apoyo administrativo para estudiantes internacionales",
        hero_title: "Todos tus trámites administrativos en Francia — organizados en un sistema estructurado.",
        hero_subtitle: "Desde documentos de vivienda hasta CAF, banca y formalidades universitarias, nuestro paquete combina orientación, herramientas y validación experta en un único sistema coordinado.",
        p1_title: "¿Te gustaría contratar todos estos servicios en un solo paquete?",
        p1_sub: "Si eliges “Sí”, verás nuestros paquetes. Si eliges “No”, registraremos tu preferencia.",
        p1_yes: "Sí - contrataría todo en un mismo paquete",
        p1_no: "No - prefiero tramitar yo mismo/a cada cosa por separado",
        p1_continue: "Continuar",
        p1_thanks: "Gracias por tu respuesta."
      }
    };

    /* ============================
       SESSION + LOGGING
    ============================ */

    function getSessionId() {
      let id = localStorage.getItem(SESSION_KEY);
      if (!id) {
        id = crypto.randomUUID();
        localStorage.setItem(SESSION_KEY, id);
      }
      return id;
    }

    function getLang() {
      return localStorage.getItem(LANG_KEY) || "en";
    }

    async function supabaseInsertEvent(event_type, payload = {}) {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/sif_events`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "apikey": SUPABASE_ANON_KEY,
          "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
          "Prefer": "return=minimal"
        },
        body: JSON.stringify({
          session_id: getSessionId(),
          event_type,
          page: "index",
          lang: getLang(),
          payload
        })
      });

      if (!res.ok) {
        const txt = await res.text().catch(() => "");
        console.warn("Supabase insert failed:", res.status, txt);
      }
    }

    /* ============================
       I18N
    ============================ */

    function t(key) {
      const lang = getLang();
      return (I18N[lang] && I18N[lang][key]) ? I18N[lang][key] : key;
    }

    function setLang(lang) {
      localStorage.setItem(LANG_KEY, lang);
      applyLang();
    }

    function applyLang() {
      const lang = getLang();

      const enBtn = document.getElementById("langEn");
      const esBtn = document.getElementById("langEs");
      if (enBtn && esBtn) {
        enBtn.classList.toggle("is-active", lang === "en");
        esBtn.classList.toggle("is-active", lang === "es");
      }

      document.querySelectorAll("[data-i18n]").forEach(el => {
        el.textContent = t(el.getAttribute("data-i18n"));
      });
    }

    /* ============================
       PAGE LOGIC
    ============================ */

    async function submitPhase1() {
      const choice = document.querySelector('input[name="bundle"]:checked')?.value || null;

      if (!choice) {
        alert("Please select Yes or No.");
        return;
      }

      await supabaseInsertEvent("phase1_bundle_answer", { bundleChoice: choice });

      if (choice === "yes") {
        window.location.href = "packages.html";
      } else {
        document.getElementById("thanksBox").hidden = false;
      }
    }

    // init
    applyLang();
  </script>

</body>
</html>
